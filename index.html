<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Destination Tracker</title>
    <!-- Add Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
    <style>
        /* [Previous CSS styles remain exactly the same] */
    </style>
</head>
<body>
    <!-- [Previous HTML remains exactly the same] -->

    <script>
        // DOM Elements [same as before]

        // State
        let destinations = [];
        let currentFilter = 'all';
        let db; // Firebase Firestore reference
        
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_AUTH_DOMAIN",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_STORAGE_BUCKET",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();

        // Get current user ID (simple anonymous auth for demo)
        function getUserId() {
            // Use a consistent ID for the demo (in real app, implement proper auth)
            let userId = localStorage.getItem('userId');
            if (!userId) {
                userId = 'user_' + Math.random().toString(36).substr(2, 9);
                localStorage.setItem('userId', userId);
            }
            return userId;
        }

        // Load destinations from Firestore
        function loadDestinations() {
            const userId = getUserId();
            
            db.collection('users').doc(userId).collection('destinations')
                .orderBy('createdAt', 'desc')
                .onSnapshot((snapshot) => {
                    destinations = [];
                    snapshot.forEach((doc) => {
                        const data = doc.data();
                        destinations.push({
                            id: doc.id,
                            name: data.name,
                            address: data.address,
                            category: data.category,
                            notes: data.notes,
                            createdAt: data.createdAt
                        });
                    });
                    renderDestinations();
                }, (error) => {
                    console.error("Error loading destinations:", error);
                    showErrorNotice("Failed to load destinations. Please check your connection.");
                });
        }

        // Save destination to Firestore
        async function addDestination(name, address, category, notes) {
            const userId = getUserId();
            
            try {
                await db.collection('users').doc(userId).collection('destinations').add({
                    name: name.trim(),
                    address: address.trim(),
                    category,
                    notes: notes.trim(),
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (error) {
                console.error("Error adding destination:", error);
                showErrorNotice("Failed to save destination. Please try again.");
            }
        }

        // Delete destination from Firestore
        async function deleteDestination(id) {
            const userId = getUserId();
            
            try {
                await db.collection('users').doc(userId).collection('destinations').doc(id).delete();
            } catch (error) {
                console.error("Error deleting destination:", error);
                showErrorNotice("Failed to delete destination. Please try again.");
            }
        }

        // Clear all destinations from Firestore
        async function clearAllDestinations() {
            const userId = getUserId();
            
            try {
                const batch = db.batch();
                const snapshot = await db.collection('users').doc(userId).collection('destinations').get();
                
                snapshot.forEach((doc) => {
                    batch.delete(doc.ref);
                });
                
                await batch.commit();
            } catch (error) {
                console.error("Error clearing destinations:", error);
                showErrorNotice("Failed to clear destinations. Please try again.");
            }
        }

        // Show error notice
        function showErrorNotice(message) {
            const existingNotice = document.querySelector('.error-notice');
            if (existingNotice) {
                existingNotice.textContent = message;
                return;
            }

            const notice = document.createElement('div');
            notice.className = 'error-notice';
            notice.textContent = message;
            notice.style.backgroundColor = '#fee2e2';
            notice.style.color = '#b91c1c';
            notice.style.padding = '8px';
            notice.style.borderRadius = '4px';
            notice.style.margin = '8px 0';
            notice.style.fontSize = '14px';
            notice.style.textAlign = 'center';

            const container = document.querySelector('.container');
            container.insertBefore(notice, container.firstChild.nextSibling);

            // Remove notice after 5 seconds
            setTimeout(() => {
                notice.remove();
            }, 5000);
        }

        // [Rest of the functions remain the same as before, except remove any localStorage/sessionStorage code]

        // Initialize app
        loadDestinations();

        // [Rest of the event listeners remain the same]
    </script>
</body>
</html>